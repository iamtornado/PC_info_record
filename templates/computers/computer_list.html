{% extends 'base.html' %}

{% block title %}计算机列表 - PC信息记录系统{% endblock %}

{% block extra_css %}
<style>
    /* 智能列宽分配 */
    .table-container table th:nth-child(1), 
    .table-container table td:nth-child(1) { width: 13%; } /* 资产编码 */
    
    .table-container table th:nth-child(2), 
    .table-container table td:nth-child(2) { width: 11%; } /* 用户名 */
    
    .table-container table th:nth-child(3), 
    .table-container table td:nth-child(3) { width: 11%; } /* 计算机名 */
    
    .table-container table th:nth-child(4), 
    .table-container table td:nth-child(4) { width: 16%; } /* 型号 */
    
    .table-container table th:nth-child(5), 
    .table-container table td:nth-child(5) { width: 22%; } /* CPU */
    
    .table-container table th:nth-child(6), 
    .table-container table td:nth-child(6) { width: 9%; }  /* 内存 */
    
    .table-container table th:nth-child(7), 
    .table-container table td:nth-child(7) { width: 16%; } /* 操作系统 */
    
    .table-container table th:nth-child(8), 
    .table-container table td:nth-child(8) { width: 9%; }  /* 状态 */
    
    .table-container table th:nth-child(9), 
    .table-container table td:nth-child(9) { width: 11%; } /* 上传时间 */
    
    .table-container table th:nth-child(10), 
    .table-container table td:nth-child(10) { width: 9%; }  /* 操作 */
    
    /* 特殊列的内容处理 */
    .table-container table td:nth-child(5) { /* CPU列 */
        font-size: 0.9em;
        line-height: 1.3;
    }
    
    .table-container table td:nth-child(7) { /* 操作系统列 */
        font-size: 0.9em;
        line-height: 1.3;
    }
    
    /* 状态列的图标优化 */
    .table-container table td:nth-child(8) {
        text-align: center;
        font-weight: bold;
    }
    
    /* 操作列居中 */
    .table-container table td:nth-child(10) {
        text-align: center;
    }
    
    /* 移动端列宽调整 */
    @media (max-width: 768px) {
        .table-container table th:nth-child(1), 
        .table-container table td:nth-child(1) { width: 16%; } /* 资产编码 */
        
        .table-container table th:nth-child(2), 
        .table-container table td:nth-child(2) { width: 13%; } /* 用户名 */
        
        .table-container table th:nth-child(3), 
        .table-container table td:nth-child(3) { width: 13%; } /* 计算机名 */
        
        .table-container table th:nth-child(4), 
        .table-container table td:nth-child(4) { width: 20%; } /* 型号 */
        
        .table-container table th:nth-child(5), 
        .table-container table td:nth-child(5) { width: 28%; } /* CPU */
        
        .table-container table th:nth-child(6), 
        .table-container table td:nth-child(6) { width: 9%; }  /* 内存 */
        
        .table-container table th:nth-child(7), 
        .table-container table td:nth-child(7) { width: 22%; } /* 操作系统 */
        
        .table-container table th:nth-child(8), 
        .table-container table td:nth-child(8) { width: 9%; }  /* 状态 */
        
        .table-container table th:nth-child(9), 
        .table-container table td:nth-child(9) { width: 13%; } /* 上传时间 */
        
        .table-container table th:nth-child(10), 
        .table-container table td:nth-child(10) { width: 11%; } /* 操作 */
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <h2>计算机列表</h2>
    
    <!-- 搜索和筛选表单 -->
    <form method="get" class="search-form">
        <div class="form-group">
            <label for="search">搜索</label>
            <input type="text" id="search" name="search" class="form-control" 
                   placeholder="搜索资产编码、用户名、计算机名、型号..." 
                   value="{{ search_query }}">
        </div>
        
        <div class="form-group">
            <label for="device_type">设备类型</label>
            <select id="device_type" name="device_type" class="form-control">
                <option value="">全部类型</option>
                {% for device_type in device_types %}
                    <option value="{{ device_type }}" {% if device_type == selected_device_type %}selected{% endif %}>
                        {{ device_type }}
                    </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="has_errors">状态筛选</label>
            <select id="has_errors" name="has_errors" class="form-control">
                <option value="">全部状态</option>
                <option value="true" {% if selected_has_errors == "true" %}selected{% endif %}>⚠️ 有错误</option>
                <option value="false" {% if selected_has_errors == "false" %}selected{% endif %}>✅ 正常</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>&nbsp;</label>
            <button type="submit" class="btn">搜索</button>
            <a href="{% url 'computers:computer_list' %}" class="btn btn-secondary">重置</a>
        </div>
    </form>
    
    <!-- 结果统计 -->
    <p style="margin-bottom: 1rem; color: #666;">
        共找到 {{ page_obj.paginator.count }} 条记录，当前显示第 {{ page_obj.start_index }}-{{ page_obj.end_index }} 条
    </p>
    
    <!-- 计算机列表表格 -->
    {% if page_obj %}
        <div class="table-container">
            <table>
            <thead>
                <tr>
                    <th>资产编码</th>
                    <th>用户名</th>
                    <th>计算机名</th>
                    <th>型号</th>
                    <th>CPU</th>
                    <th>内存</th>
                    <th>操作系统</th>
                    <th>状态</th>
                    <th>上传时间</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for computer in page_obj %}
                    <tr>
                        <td>{{ computer.asset_code }}</td>
                        <td>{{ computer.user_name }}</td>
                        <td>{{ computer.computer_name }}</td>
                        <td>{{ computer.model }}</td>
                        <td>{{ computer.cpu_model }}</td>
                        <td>{{ computer.memory_size }}GB</td>
                        <td>{{ computer.os_version }}</td>
                        <td>
                            {% if computer.has_errors %}
                                <span style="color: #e74c3c; font-weight: bold;">⚠️ 有错误</span>
                            {% else %}
                                <span style="color: #27ae60; font-weight: bold;">✅ 正常</span>
                            {% endif %}
                        </td>
                        <td>{{ computer.upload_time|date:"Y-m-d H:i" }}</td>
                        <td>
                            <a href="{% url 'computers:computer_detail' computer.pk %}" class="btn">查看详情</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
            </table>
        </div>
        
        <!-- 分页 -->
        {% if page_obj.has_other_pages %}
            <div class="pagination">
                {% if page_obj.has_previous %}
                    <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_device_type %}&device_type={{ selected_device_type }}{% endif %}{% if selected_has_errors %}&has_errors={{ selected_has_errors }}{% endif %}">首页</a>
                    <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_device_type %}&device_type={{ selected_device_type }}{% endif %}{% if selected_has_errors %}&has_errors={{ selected_has_errors }}{% endif %}">上一页</a>
                {% endif %}
                
                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                        <span class="current">{{ num }}</span>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_device_type %}&device_type={{ selected_device_type }}{% endif %}{% if selected_has_errors %}&has_errors={{ selected_has_errors }}{% endif %}">{{ num }}</a>
                    {% endif %}
                {% endfor %}
                
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_device_type %}&device_type={{ selected_device_type }}{% endif %}{% if selected_has_errors %}&has_errors={{ selected_has_errors }}{% endif %}">下一页</a>
                    <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_device_type %}&device_type={{ selected_device_type }}{% endif %}{% if selected_has_errors %}&has_errors={{ selected_has_errors }}{% endif %}">末页</a>
                {% endif %}
            </div>
        {% endif %}
    {% else %}
        <p style="text-align: center; color: #666; padding: 2rem;">没有找到符合条件的记录</p>
    {% endif %}
</div>
{% endblock %}
